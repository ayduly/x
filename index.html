<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Misliscore</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* --- TASARIM AYARLARI (GOLD & DARK) --- */
    :root {
      --header-bg: #000000;
      --sub-header: #1a1a1a;
      --body-bg: #121212;
      --card-bg: #1e1e1e;
      --text-main: #e0e0e0;
      --text-muted: #888888;
      --gold: #FFD700;
      --border: #333333;
      --row-hover: #252525;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background-color: var(--body-bg); color: var(--text-main); font-size: 13px; }
    a { text-decoration: none; color: inherit; }

    /* HEADER */
    header {
      background-color: var(--header-bg); height: 60px; display: flex; align-items: center; padding: 0 15%;
      position: sticky; top: 0; z-index: 1000; border-bottom: 2px solid var(--gold);
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    .logo { font-family: 'Rajdhani', sans-serif; font-size: 28px; font-weight: 700; color: #fff; margin-right: 50px; letter-spacing: 1px; }
    .logo span { color: var(--gold); }
    
    /* NAVIGASYON (SPOR DALLARI) */
    .main-nav { display: flex; gap: 20px; height: 100%; }
    .nav-item { 
      display: flex; align-items: center; height: 100%; cursor: pointer; color: #aaa; font-weight: 500;
      border-bottom: 3px solid transparent; transition: 0.3s; font-size: 14px;
    }
    .nav-item:hover, .nav-item.active { color: var(--gold); border-bottom-color: var(--gold); }

    /* ALT MENÜ */
    .sub-header { background: var(--sub-header); padding: 0 15%; height: 45px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
    .date-text { color: #888; font-weight: bold; }
    
    /* İÇERİK ALANI */
    .container { display: flex; width: 70%; margin: 20px auto; gap: 20px; }
    .content { flex: 1; }

    /* KART VE LİSTE YAPISI */
    .league-group { background: var(--card-bg); border: 1px solid var(--border); margin-bottom: 20px; border-radius: 6px; overflow: hidden; }
    .lg-header {
      background: linear-gradient(90deg, #252525 0%, #1e1e1e 100%); padding: 10px 15px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 10px; font-weight: 700; color: var(--text-main); font-size: 14px;
    }
    .flag { width: 4px; height: 16px; background: var(--gold); display: inline-block; border-radius: 2px; }

    .match-row {
      display: flex; align-items: center; padding: 12px 15px; border-bottom: 1px solid var(--border);
      cursor: pointer; font-size: 14px; height: 55px; transition: background 0.2s;
    }
    .match-row:last-child { border-bottom: none; }
    .match-row:hover { background: var(--row-hover); }

    .m-status { width: 50px; font-size: 12px; text-align: center; color: var(--text-muted); display:flex; flex-direction:column; justify-content:center; }
    .m-teams { flex: 1; display: flex; justify-content: space-between; padding: 0 30px; font-weight: 500; color: #fff; }
    .m-score { 
      background: #000; color: var(--gold); font-weight: 700; padding: 5px 12px; font-family: 'Rajdhani', sans-serif; 
      font-size: 16px; border-radius: 4px; margin: 0 20px; width: 60px; text-align: center; border: 1px solid #333;
    }

    .loading { text-align: center; padding: 40px; color: var(--gold); font-size: 16px; }
    .error-box { background: rgba(255, 0, 0, 0.1); color: #ff5252; padding: 15px; text-align: center; margin-bottom: 20px; border-radius: 6px; display: none; }
  </style>
</head>
<body>

<header>
  <div class="logo">MISLI<span>SCORE</span></div>
  <nav class="main-nav">
    <div class="nav-item active" onclick="switchSport('football', this)">FUTBOL</div>
    <div class="nav-item" onclick="switchSport('basketball', this)">BASKETBOL</div>
  </nav>
</header>

<div class="sub-header">
  <div class="date-text">CANLI SONUÇLAR</div>
  <div style="font-size:11px; color:#555">Sportbex API v2</div>
</div>

<div class="container">
  <div class="content">
    <div id="error-area" class="error-box"></div>
    <div id="match-container"><div class="loading">Yükleniyor...</div></div>
  </div>
</div>

<script>
const API_KEY = "8aPROa85kIgwqnTOhMQFEokJ4Jtc6oY1Pn9DUG7G"; 
let currentSport = 'football';

// Başlangıç
init();

function switchSport(sport, btn) {
  currentSport = sport;
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  
  // Renk değişimi (Opsiyonel)
  if(sport === 'basketball') document.documentElement.style.setProperty('--gold', '#FF9800');
  else document.documentElement.style.setProperty('--gold', '#FFD700');

  document.getElementById("match-container").innerHTML = '<div class="loading">Veriler Çekiliyor...</div>';
  init();
}

async function init() {
  const listDiv = document.getElementById("match-container");
  const errorDiv = document.getElementById("error-area");
  errorDiv.style.display = 'none';

  try {
    let endpoint = "";
    if (currentSport === 'football') {
        // Futbol ID:1 (Trial versiyon)
        endpoint = "/api/sportbex/league/1/matches?page=1&perPage=50";
    } else {
        // Basketbol Lig Listesi ID:7522
        endpoint = "/api/basket/competitions/7522";
    }

    const res = await fetch(endpoint, {
        headers: { "sportbex-api-key": API_KEY }
    });

    if (!res.ok) throw new Error(`API Hatası: ${res.status}`);
    const data = await res.json();
    
    let items = [];
    
    if(currentSport === 'football') {
       if(Array.isArray(data)) items = data;
       else if(data.results) items = data.results;
       else if(data.data) items = data.data;

       if(items.length === 0) listDiv.innerHTML = "<div class='loading'>Şu an maç yok. (ID: 1)</div>";
       else renderFootball(items);

    } else {
       items = Array.isArray(data) ? data : (data.result || []);
       if(items.length === 0) listDiv.innerHTML = "<div class='loading'>Basketbol verisi yok.</div>";
       else renderBasketball(items);
    }

  } catch (err) {
    listDiv.innerHTML = "";
    errorDiv.style.display = 'block';
    errorDiv.innerHTML = `Bağlantı Hatası: ${err.message}`;
  }
}

// Futbol Render (Lig Gruplamalı)
function renderFootball(matches) {
  const listDiv = document.getElementById("match-container");
  const grouped = {};

  matches.forEach(m => {
    let league = m.competition?.name || m.league_name || "Diğer Maçlar";
    if(!grouped[league]) grouped[league] = [];
    grouped[league].push(m);
  });

  let html = "";
  for (const [league, items] of Object.entries(grouped)) {
    html += `
      <div class="league-group">
        <div class="lg-header"><span class="flag"></span> ${league}</div>`;
    
    items.forEach(m => {
      let h = m.homeTeam?.name || m.home_team || "Ev Sahibi";
      let a = m.awayTeam?.name || m.away_team || "Deplasman";
      let hs = m.score?.home ?? "-";
      let as = m.score?.away ?? "-";
      let time = m.matchDate ? new Date(m.matchDate).toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'}) : 'MS';
      let id = m.matchId || m.id;
      let url = id ? `match.html?id=${id}&sport=football` : '#';

      html += `
        <div class="match-row" onclick="location.href='${url}'">
          <div class="m-status"><span>${time}</span></div>
          <div class="m-teams">
            <div style="text-align:right; flex:1">${h}</div>
            <div class="m-score">${hs} - ${as}</div>
            <div style="text-align:left; flex:1">${a}</div>
          </div>
        </div>`;
    });
    html += `</div>`;
  }
  listDiv.innerHTML = html;
}

// Basketbol Render (Lig Listesi)
function renderBasketball(items) {
  const listDiv = document.getElementById("match-container");
  let html = "";
  
  items.forEach(item => {
    let comp = item.competition || item; 
    let name = comp.name || "Bilinmeyen Lig";
    let region = comp.competitionRegion || "Dünya";
    let id = comp.id;

    // Basketbolda lige tıklayınca uyarı verelim veya ID gösterelim
    html += `
      <div class="league-group" onclick="alert('Bu ligin detayları Sportbex Trial sürümünde kısıtlı olabilir. ID: ${id}')" style="cursor:pointer">
        <div class="match-row">
           <div class="m-status" style="color:var(--gold)">LİG</div>
           <div class="m-teams">
             <div style="text-align:left; font-size:16px">${name} <span style="font-size:12px; color:#666">(${region})</span></div>
           </div>
        </div>
      </div>`;
  });
  listDiv.innerHTML = html;
}
</script>
</body>
</html>