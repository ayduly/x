<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Misliscore - Canlı</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
  <style>
    /* --- GOLD & DARK TEMA AYARLARI --- */
    :root {
      --bg-dark: #121212;
      --bg-header: #000000;
      --bg-card: #1e1e1e;
      --bg-hover: #252525;
      
      --text-main: #e0e0e0;
      --text-muted: #888;
      
      --gold: #FFD700;
      --border: #333;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background-color: var(--bg-dark); color: var(--text-main); font-size: 13px; }
    ul { list-style: none; }
    a { text-decoration: none; color: inherit; }

    /* --- HEADER --- */
    header {
      background-color: var(--bg-header);
      height: 60px;
      display: flex; align-items: center; padding: 0 10%;
      border-bottom: 2px solid var(--gold);
      position: sticky; top: 0; z-index: 999;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .logo { font-family: 'Rajdhani', sans-serif; font-size: 28px; font-weight: 700; color: #fff; margin-right: 40px; letter-spacing: 1px; }
    .logo span { color: var(--gold); }
    
    .nav { display: flex; gap: 20px; height: 100%; }
    .nav-item { 
      display: flex; align-items: center; height: 100%; cursor: pointer; color: #aaa; font-weight: 500; 
      border-bottom: 3px solid transparent; transition: 0.3s;
    }
    .nav-item:hover, .nav-item.active { color: var(--gold); border-bottom-color: var(--gold); }

    /* --- ALT MENÜ (TARİH) --- */
    .sub-header {
      background: #1a1a1a; padding: 0 10%; height: 45px;
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid var(--border);
    }
    .date-info { color: var(--gold); font-weight: bold; font-family: 'Rajdhani', sans-serif; letter-spacing: 1px; }
    
    .filters button {
      background: #333; border: 1px solid #444; color: #ccc;
      padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold;
    }
    .filters button.active { background: var(--gold); color: #000; border-color: var(--gold); }

    /* --- ANA YAPI (SOL + ORTA) --- */
    .container { display: flex; width: 85%; margin: 20px auto; gap: 20px; }

    /* SOL MENÜ (SIDEBAR) */
    .sidebar { width: 240px; flex-shrink: 0; }
    .sidebar-card { background: var(--bg-card); border: 1px solid var(--border); margin-bottom: 15px; border-radius: 6px; overflow: hidden; }
    
    .sb-header { 
      background: linear-gradient(90deg, #252525 0%, #1e1e1e 100%);
      padding: 10px 12px; font-weight: 700; color: var(--gold); font-size: 12px;
      border-bottom: 1px solid var(--border); font-family: 'Rajdhani', sans-serif; letter-spacing: 0.5px;
    }
    
    .sb-list li {
      padding: 10px 12px; border-bottom: 1px solid var(--border); cursor: pointer;
      display: flex; justify-content: space-between; color: #ccc; transition: .2s;
    }
    .sb-list li:hover { background: var(--bg-hover); color: var(--gold); padding-left: 15px; }
    .badge { background: #333; padding: 2px 6px; border-radius: 4px; font-size: 10px; color: #888; }

    /* ORTA ALAN (MAÇ LİSTESİ) */
    .content { flex: 1; }

    .league-group { background: var(--bg-card); border: 1px solid var(--border); margin-bottom: 15px; border-radius: 6px; overflow: hidden; }
    
    .lg-header {
      background: linear-gradient(90deg, #252525 0%, #1e1e1e 100%);
      padding: 10px 15px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 10px; font-weight: 700; color: #fff; font-size: 13px;
    }
    .flag { width: 4px; height: 14px; background: var(--gold); display: inline-block; border-radius: 2px; }

    .match-row {
      display: flex; align-items: center; padding: 10px 15px;
      border-bottom: 1px solid var(--border); cursor: pointer; height: 50px;
      transition: background 0.2s;
    }
    .match-row:last-child { border-bottom: none; }
    .match-row:hover { background: var(--bg-hover); }

    .m-status { width: 45px; font-size: 11px; text-align: center; color: var(--text-muted); display:flex; flex-direction: column; justify-content: center; }
    
    .m-teams { flex: 1; display: flex; justify-content: space-between; padding: 0 30px; font-weight: 500; font-size: 14px; }
    .home { text-align: right; flex: 1; }
    .away { text-align: left; flex: 1; }
    
    .m-score {
      background: #000; color: var(--gold); font-weight: 700;
      padding: 4px 10px; border-radius: 4px; margin: 0 20px; width: 60px; text-align: center;
      border: 1px solid #333; font-family: 'Rajdhani', sans-serif; font-size: 15px;
    }

    /* Durum mesajları */
    .loading { text-align: center; padding: 50px; color: var(--gold); font-size: 16px; font-weight: bold; }
    .error-msg { background: rgba(255, 0, 0, 0.1); border: 1px solid #ff3333; color: #ff6666; padding: 15px; border-radius: 6px; margin-bottom: 20px; display: none; text-align: center;}

    footer { text-align: center; padding: 30px; color: #555; font-size: 11px; margin-top: 20px; border-top: 1px solid var(--border); }
  </style>
</head>
<body>

<header>
  <div class="logo">MISLI<span>SCORE</span></div>
  <nav class="nav">
    <div class="nav-item active" onclick="switchSport('football', this)">FUTBOL</div>
    <div class="nav-item" onclick="switchSport('basketball', this)">BASKETBOL</div>
  </nav>
</header>

<div class="sub-header">
  <div class="date-info" id="date-display">BUGÜNÜN MAÇLARI</div>
  <div class="filters">
    <button class="active" onclick="alert('API şu an tüm maçları getiriyor.')">Tümü</button>
    <button onclick="alert('Canlı filtreleme API desteği gerektirir.')">Canlı</button>
  </div>
</div>

<div class="container">
  
  <div class="sidebar">
    <div class="sidebar-card">
      <div class="sb-header">POPÜLER LİGLER</div>
      <ul class="sb-list">
        <li><span>Süper Lig</span> <span class="badge">TR</span></li>
        <li><span>Premier League</span> <span class="badge">EN</span></li>
        <li><span>La Liga</span> <span class="badge">ES</span></li>
        <li><span>Bundesliga</span> <span class="badge">DE</span></li>
        <li><span>Serie A</span> <span class="badge">IT</span></li>
        <li><span>Ligue 1</span> <span class="badge">FR</span></li>
      </ul>
    </div>
    
    <div class="sidebar-card">
      <div class="sb-header">SPORBEX API</div>
      <div style="padding:15px; color:#666; font-size:11px; line-height:1.5;">
        Bu veriler Sportbex Trial API üzerinden canlı olarak çekilmektedir.
      </div>
    </div>
  </div>

  <div class="content">
    <div id="error-area" class="error-msg"></div>
    <div id="match-container">
      <div class="loading">Veriler Yükleniyor...</div>
    </div>
  </div>

</div>

<footer>
  © 2025 Misliscore. Gold Premium Arayüz.
</footer>

<script>
const API_KEY = "8aPROa85kIgwqnTOhMQFEokJ4Jtc6oY1Pn9DUG7G"; 
let currentSport = 'football';

// Sayfa yüklenince
init();

// Tarih Gösterimi
const d = new Date();
document.getElementById('date-display').innerText = d.toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }).toUpperCase();

function switchSport(sport, btn) {
  currentSport = sport;
  
  // Tab stili
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  
  // Renk değişimi
  if(sport === 'basketball') document.documentElement.style.setProperty('--gold', '#FF9800');
  else document.documentElement.style.setProperty('--gold', '#FFD700');

  // Listeyi temizle ve yeniden çek
  document.getElementById("match-container").innerHTML = '<div class="loading">Veriler Çekiliyor...</div>';
  init();
}

async function init() {
  const listDiv = document.getElementById("match-container");
  const errorDiv = document.getElementById("error-area");
  errorDiv.style.display = 'none';

  try {
    let endpoint = "";
    if (currentSport === 'football') {
        // FUTBOL: "Matches by Date" kullanarak lig lig gruplayacağız
        // Tarih parametresi gerekebilir, şimdilik default (bugün)
        endpoint = "/api/sportbex/match/by-date"; 
    } else {
        // BASKETBOL: Ligleri Listele
        endpoint = "/api/basket/competitions/7522"; 
    }

    const res = await fetch(endpoint, {
        headers: { "sportbex-api-key": API_KEY }
    });

    if (!res.ok) throw new Error(`API Hatası: ${res.status}`);
    const data = await res.json();
    
    // Veri yapısını kontrol et
    let items = [];
    if(Array.isArray(data)) items = data;
    else if(data.results) items = data.results;
    else if(data.data) items = data.data;
    else if(data.result) items = data.result; // Basketbol için genelde result

    if(items.length === 0) {
        listDiv.innerHTML = "<div class='loading' style='color:#888'>Şu an maç/veri bulunamadı.</div>";
        return;
    }

    if(currentSport === 'football') renderFootball(items);
    else renderBasketball(items);

  } catch (err) {
    listDiv.innerHTML = "";
    errorDiv.style.display = 'block';
    errorDiv.innerHTML = `Bağlantı Hatası: ${err.message}<br><small>vercel.json dosyasını yüklediğinden emin ol.</small>`;
  }
}

// --- FUTBOL RENDER (LİGLERE GÖRE GRUPLAMA) ---
function renderFootball(matches) {
  const listDiv = document.getElementById("match-container");
  const grouped = {};

  // Maçları Lig İsimlerine Göre Grupla
  matches.forEach(m => {
    let leagueName = "Diğer Maçlar";
    if (m.competition && m.competition.name) leagueName = m.competition.name;
    else if (m.league_name) leagueName = m.league_name;
    
    if (!grouped[leagueName]) grouped[leagueName] = [];
    grouped[leagueName].push(m);
  });

  let html = "";
  for (const [league, items] of Object.entries(grouped)) {
    html += `
      <div class="league-group">
        <div class="lg-header"><span class="flag"></span> ${league}</div>`;
    
    items.forEach(m => {
      let h = m.homeTeam?.name || m.home_team || "Ev Sahibi";
      let a = m.awayTeam?.name || m.away_team || "Deplasman";
      let hs = m.score?.home ?? m.home_score ?? "-";
      let as = m.score?.away ?? m.away_score ?? "-";
      
      let d = m.matchDate || m.date ? new Date(m.matchDate || m.date) : new Date();
      let time = d.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'});
      
      // Detay ID
      let id = m.matchId || m.id || m._id;
      let url = id ? `match.html?id=${id}&sport=football` : '#';

      html += `
        <div class="match-row" onclick="location.href='${url}'">
          <div class="m-status"><span>${time}</span><span style="font-size:9px; color:#666">MS</span></div>
          <div class="m-teams">
            <div class="home">${h}</div>
            <div class="m-score">${hs} - ${as}</div>
            <div class="away">${a}</div>
          </div>
        </div>`;
    });
    html += `</div>`;
  }
  listDiv.innerHTML = html;
}

// --- BASKETBOL RENDER (LİG LİSTESİ) ---
function renderBasketball(items) {
  const listDiv = document.getElementById("match-container");
  let html = "";
  
  items.forEach(item => {
    let comp = item.competition || item; 
    let name = comp.name || "Bilinmeyen Lig";
    let region = comp.competitionRegion || "Dünya";
    
    html += `
      <div class="league-group" style="cursor:pointer" onclick="alert('Basketbol detayı yakında eklenecek.')">
        <div class="match-row">
           <div class="m-status" style="color:var(--gold); font-weight:bold">BSK</div>
           <div class="m-teams">
             <div style="text-align:left; font-size:16px">${name} <span style="font-size:12px; color:#666">(${region})</span></div>
           </div>
        </div>
      </div>`;
  });
  listDiv.innerHTML = html;
}
</script>
</body>
</html>