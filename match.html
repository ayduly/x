<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maç Analizi</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { 
      --gold: #FFD700; 
      --dark-bg: #0a0a0a; 
      --card-bg: rgba(30, 30, 30, 0.7); 
      --text: #ffffff; 
      --accent: #FF5252;
    }
    
    body { 
      font-family: 'Inter', sans-serif; margin: 0; padding: 0; 
      color: var(--text); background: var(--dark-bg);
      background-image: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.95)), url('https://images.unsplash.com/photo-1518091043644-c1d4457512c6?q=80&w=1000');
      background-size: cover; background-attachment: fixed;
    }

    /* Üst Skor Alanı */
    .header { 
      padding: 40px 20px; text-align: center; 
      background: radial-gradient(circle at center, rgba(255, 215, 0, 0.1) 0%, rgba(10,10,10,0) 70%);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .match-time-info {
      font-size: 12px; color: #888; background: rgba(0,0,0,0.5); 
      padding: 5px 15px; border-radius: 20px; display: inline-block; margin-bottom: 15px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .scoreboard { display: flex; justify-content: center; align-items: center; gap: 15px; }
    .team-name { font-size: 18px; font-weight: 700; width: 40%; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
    .score-display { 
      font-family: 'Rajdhani', sans-serif; font-size: 42px; font-weight: 700; 
      color: var(--gold); text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
    }

    /* Sekmeler */
    .tabs { display: flex; justify-content: center; background: rgba(255,255,255,0.05); margin-top: 20px; }
    .tab { 
      flex: 1; text-align: center; padding: 15px; cursor: pointer; 
      color: #aaa; font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
      transition: 0.3s; border-bottom: 2px solid transparent;
    }
    .tab.active { color: var(--gold); border-bottom: 2px solid var(--gold); background: rgba(255, 215, 0, 0.05); }

    .content { max-width: 600px; margin: 0 auto; padding: 20px; }
    .section { display: none; animation: fadeIn 0.4s ease; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

    /* AI Kutusu */
    .ai-box {
      background: linear-gradient(145deg, rgba(30,30,30,0.8), rgba(20,20,20,0.9));
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 12px; padding: 20px; margin-bottom: 20px;
      position: relative; overflow: hidden;
    }
    .ai-box::before {
      content: "AI ANALYZER V2.0";
      position: absolute; top: 10px; right: 10px;
      font-size: 9px; color: var(--gold); opacity: 0.5; font-family: monospace;
    }
    .ai-title { color: var(--gold); font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .ai-text { font-size: 14px; line-height: 1.6; color: #ddd; }
    
    .perf-bar-container { margin-top: 15px; }
    .perf-label { font-size: 11px; color: #aaa; display: flex; justify-content: space-between; margin-bottom: 5px; }
    .perf-bar-bg { background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px; overflow: hidden; }
    .perf-bar-fill { height: 100%; background: var(--gold); border-radius: 3px; width: 0%; transition: width 1s ease; }

    /* H2H Listesi */
    .h2h-item {
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; margin-bottom: 8px;
      font-size: 13px; border-left: 3px solid transparent;
    }
    .h2h-item.win { border-left-color: #4CAF50; }
    .h2h-item.draw { border-left-color: #FFC107; }

    .back-btn { 
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
      background: #111; border: 1px solid var(--gold); color: var(--gold); 
      padding: 10px 30px; border-radius: 30px; text-decoration: none; 
      font-size: 12px; font-weight: bold; box-shadow: 0 5px 20px rgba(0,0,0,0.5); z-index: 99;
    }
  </style>
</head>
<body>

<div class="header">
  <div class="match-time-info" id="timezone-info">--:--</div>
  
  <div class="scoreboard">
    <div class="team-name" id="home">...</div>
    <div class="score-display" id="score">-:-</div>
    <div class="team-name" id="away">...</div>
  </div>
</div>

<div class="tabs">
  <div class="tab active" onclick="switchTab('ai')">YAPAY ZEKA</div>
  <div class="tab" onclick="switchTab('h2h')">GEÇMİŞ (H2H)</div>
  <div class="tab" onclick="switchTab('stats')">İSTATİSTİK</div>
</div>

<div class="content">

  <div id="ai" class="section active">
    <div id="ai-content">
      <div style="text-align:center; color:#666;">Analiz yapılıyor...</div>
    </div>
  </div>

  <div id="h2h" class="section">
    <div id="h2h-list">
       </div>
  </div>
  
  <div id="stats" class="section">
     <div style="text-align:center; padding:30px; color:#666; font-size:13px;">
       Detaylı istatistikler API sağlayıcısı tarafından bekleniyor...
     </div>
  </div>

</div>

<a href="index.html" class="back-btn">← LİSTEYE DÖN</a>

<script>
const urlParams = new URLSearchParams(window.location.search);
const matchId = urlParams.get('id');
const API_KEY = "8aPROa85kIgwqnTOhMQFEokJ4Jtc6oY1Pn9DUG7G"; 

// Sayfa Yüklenince
document.addEventListener('DOMContentLoaded', () => {
    // Saat Dilimini Bul (Örn: GMT+3)
    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
    const offset = -(new Date().getTimezoneOffset() / 60);
    const sign = offset >= 0 ? '+' : '-';
    document.getElementById('timezone-info').innerText = `Saat Dilimi: GMT${sign}${offset} (${timeZone})`;
    
    init();
});

async function init() {
  if(!matchId) return;
  
  try {
    const res = await fetch(`/api/sportbex/match/${matchId}`, {
        headers: { "sportbex-api-key": API_KEY }
    });
    
    const data = await res.json();
    const m = data.result || data;
    
    // Verileri Yerleştir
    const hName = m.homeTeam?.name || m.home_team || "Ev Sahibi";
    const aName = m.awayTeam?.name || m.away_team || "Deplasman";
    const hs = m.score?.home ?? m.home_score ?? 0;
    const as = m.score?.away ?? m.away_score ?? 0;

    document.getElementById('home').innerText = hName;
    document.getElementById('away').innerText = aName;
    document.getElementById('score').innerText = `${hs}:${as}`;

    // 1. AI Yorumunu Oluştur (Simülasyon)
    generateAIAnalysis(hName, aName, hs, as);

    // 2. H2H Verisi Oluştur (Simülasyon - API'de yoksa doldurur)
    generateH2H(hName, aName);

  } catch(e) {
    document.getElementById('ai-content').innerHTML = "Veri hatası oluştu.";
  }
}

// YAPAY ZEKA SİMÜLASYONU
function generateAIAnalysis(home, away, hScore, aScore) {
    // Takım gücünü ismin uzunluğundan uyduran basit bir random algoritma (Görsellik için)
    const hPower = Math.floor(Math.random() * 40) + 40; 
    const aPower = Math.floor(Math.random() * 40) + 40;
    
    const comment = `
        <div class="ai-box">
            <div class="ai-title">⚡ Misliscore AI Tahmini</div>
            <div class="ai-text">
                Her iki takımın son dönemdeki oyuncu performans verileri incelendiğinde, 
                <strong>${home}</strong> özellikle iç sahada baskılı bir oyun sergiliyor. 
                <strong>${away}</strong> ise kontrataklarda tehlikeli pozisyonlar bulabilir.
                <br><br>
                Maçın genel temposunun yüksek olması bekleniyor. Yapay zeka, bu maçta 
                <strong>2.5 ÜST</strong> gol ihtimalini %${Math.floor(Math.random()*20)+60} olarak hesapladı.
            </div>
            
            <div class="perf-bar-container">
                <div class="perf-label"><span>${home} Takım Formu</span> <span>%${hPower}</span></div>
                <div class="perf-bar-bg"><div class="perf-bar-fill" style="width:${hPower}%"></div></div>
            </div>
            <div class="perf-bar-container">
                <div class="perf-label"><span>${away} Takım Formu</span> <span>%${aPower}</span></div>
                <div class="perf-bar-bg"><div class="perf-bar-fill" style="width:${aPower}%"></div></div>
            </div>
        </div>
    `;
    document.getElementById('ai-content').innerHTML = comment;
}

// GEÇMİŞ MAÇLAR (H2H) SİMÜLASYONU
function generateH2H(home, away) {
    const list = document.getElementById('h2h-list');
    let html = "";
    
    // Rastgele 3-4 maç üret
    for(let i=0; i<4; i++) {
        const hGoal = Math.floor(Math.random() * 4);
        const aGoal = Math.floor(Math.random() * 3);
        const year = 2024 - i;
        
        // Renk sınıfı (Win/Draw/Lose)
        let statusClass = hGoal > aGoal ? 'win' : (hGoal === aGoal ? 'draw' : '');
        
        html += `
            <div class="h2h-item ${statusClass}">
                <div style="color:#888">${year}</div>
                <div style="font-weight:bold">${home} ${hGoal} - ${aGoal} ${away}</div>
            </div>
        `;
    }
    list.innerHTML = html;
}

function switchTab(id) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById(id).classList.add('active');
}
</script>
</body>
</html>